
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 19.5
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2025 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: 22-user 8-core network, expiring 30 Jun 2026
Serial number: 501909306443
  Licensed to: Jeffrey Ohl
               University of Chicago

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.

. do chicago_synth_placebo_topq.do 

. /*
> Placebo tests - TOP QUARTILE ONLY (>=42 users/month pre-treatment)
> Filters out noisy small ZIP3s that produce meaningless placebo ratios.
> Includes pre_median_price matching.
> 
> INCREMENTAL: Checks for existing results and resumes from where it left off.
> */
. 
. clear all

. set more off

. 
. * Output directory (matches load_chatgpt_data.py settings)
. local outdir "/Users/jeffreyohl/Dropbox/LLM_PassThrough/output/unique_users/1
> 5to25/all_merchants"

. 
. * ===========================================================================
. * Check for existing results (incremental mode)
. * ===========================================================================
. local done_units ""

. capture confirm file "`outdir'/placebo_results_topq.dta"

. if _rc == 0 {
.     use "`outdir'/placebo_results_topq.dta", clear
.     count
  0
.     local n_done = r(N)
.     di "INCREMENTAL MODE: Found `n_done' completed units"
INCREMENTAL MODE: Found 0 completed units
.     levelsof zip3_id, local(done_units)

. }

. else {
.     di "FRESH START: No existing results found"
.     local n_done = 0
. }

. 
. * Create output file for summary results (append mode if exists)
. tempname results

. if `n_done' > 0 {
.     * Append to existing file
.     postfile `results' int(zip3_id) double(pre_rmspe post_rmspe ratio ///
>         pre_gap_mean post_gap_mean final_gap) ///
>         using "`outdir'/placebo_results_new.dta", replace
. }

. else {
.     * Fresh start
.     postfile `results' int(zip3_id) double(pre_rmspe post_rmspe ratio ///
>         pre_gap_mean post_gap_mean final_gap) ///
>         using "`outdir'/placebo_results_topq.dta", replace
. 
.     * Create empty dataset for full series (long format)
.     clear
.     gen int zip3_id = .
.     gen int month_num = .
.     gen double y_treated = .
.     gen double y_synthetic = .
.     gen double gap = .
.     save "`outdir'/placebo_series_long.dta", replace
(dataset contains 0 observations)
file
    /Users/jeffreyohl/Dropbox/LLM_PassThrough/output/unique_users/15to25/all_
    > merchants/placebo_series_long.dta saved
. }

. 
. * ===========================================================================
. * First: Get Chicago's RMSPE from already-computed results
. * ===========================================================================
. use "`outdir'/synth_results.dta", clear

. gen gap = _Y_treated - _Y_synthetic
(717 missing values generated)

. gen gap_sq = gap^2
(717 missing values generated)

. 
. sum gap_sq if _time < 10

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      gap_sq |          7    .0007112    .0006694   2.67e-07   .0016721

. local chicago_pre_rmspe = sqrt(r(mean))

. 
. sum gap_sq if _time >= 10

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      gap_sq |         14    .0219601     .022855   2.50e-06    .071468

. local chicago_post_rmspe = sqrt(r(mean))

. 
. local chicago_ratio = `chicago_post_rmspe' / `chicago_pre_rmspe'

. 
. * Signed gaps
. sum gap if _time < 10

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         gap |          7    .0008163    .0287921  -.0408918   .0401327

. local chicago_pre_gap = r(mean)

. 
. sum gap if _time >= 10

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         gap |         14   -.1184999    .0923412   -.267335   .0270488

. local chicago_post_gap = r(mean)

. 
. * Final period gap (month 21)
. sum gap if _time == 21

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         gap |          1   -.2164644           .  -.2164644  -.2164644

. local chicago_final_gap = r(mean)

. 
. di "Chicago: pre_rmspe=`chicago_pre_rmspe', post_rmspe=`chicago_post_rmspe', 
> ratio=`chicago_ratio'"
Chicago: pre_rmspe=.0266688307938039, post_rmspe=.1481892713686428, ratio=5.556
> 646727950006

. di "  pre_gap=`chicago_pre_gap', post_gap=`chicago_post_gap', final_gap=`chic
> ago_final_gap'"
  pre_gap=.0008162869073983, post_gap=-.1184998924228629, final_gap=-.216464355
> 5879593

. post `results' (606) (`chicago_pre_rmspe') (`chicago_post_rmspe') (`chicago_r
> atio') ///
>     (`chicago_pre_gap') (`chicago_post_gap') (`chicago_final_gap')

. 
. * Add Chicago's series to long dataset
. use "`outdir'/synth_results.dta", clear

. gen int zip3_id = 606

. gen gap = _Y_treated - _Y_synthetic
(717 missing values generated)

. rename _time month_num

. rename _Y_treated y_treated

. rename _Y_synthetic y_synthetic

. keep zip3_id month_num y_treated y_synthetic gap

. append using "`outdir'/placebo_series_long.dta"
(variable gap was float, now double to accommodate using data's values)

. save "`outdir'/placebo_series_long.dta", replace
file
    /Users/jeffreyohl/Dropbox/LLM_PassThrough/output/unique_users/15to25/all_
    > merchants/placebo_series_long.dta saved

. 
. * ===========================================================================
. * Identify TOP QUARTILE units by pre-period usage
. * ===========================================================================
. use "data/synth_panel.dta", clear

. 
. * Balance panel first
. bysort zip3_id: gen n_months = _N

. keep if n_months == 21
(1,983 observations deleted)

. drop n_months

. 
. * Compute pre-period mean log_users by unit
. bysort zip3_id: egen pre_mean_log = mean(log_users) if month_num < 10
(10,346 missing values generated)

. bysort zip3_id: egen pre_avg_log = max(pre_mean_log)

. drop pre_mean_log

. 
. * Convert to users (exp of log)
. gen pre_avg_users = exp(pre_avg_log)

. 
. * Get 75th percentile
. quietly sum pre_avg_users, detail

. local q75 = r(p75)

. di "Top quartile threshold: `q75' users/month"
Top quartile threshold: 51.56502532958984 users/month

. 
. * Keep only top quartile
. keep if pre_avg_users >= `q75'
(11,634 observations deleted)

. 
. * Get list of qualifying units
. levelsof zip3_id, local(top_units)
15 56 60 62 65 66 69 72 77 80 82 87 94 99 162 171 172 173 174 175 181 182 184 1
> 85 187 189 196 197 198 199 205 207 208 210 216 242 244 245 246 247 250 251 25
> 2 256 262 264 265 266 267 270 271 272 273 275 289 290 291 292 294 295 296 297
>  298 299 300 301 302 303 304 305 306 307 308 309 311 312 316 332 334 452 479 
> 495 496 497 498 502 538 544 610 613 665 666 667 674 675 676 684 685 686 687 6
> 92 693 694 697 698 699 711 712 713 714 715 716 717 718 721 744 745 747 748 75
> 2 754 755 756 757 760 767 779 780 782 783 786 787 789 791 792 793 794 795 796
>  797 798 800 801 803 804 805 806 807 809 810 811 812 813 814 816 817 820 821 
> 822 823 824 825 826 827 828 830 831 832 833 834 835 837 838 839 840 845 847 8
> 48 849 855 856 857 858 861 869

. local n_units : word count `top_units'

. di "Top quartile units: `n_units'"
Top quartile units: 185

. 
. * Save to file for reference
. preserve

. keep zip3_id zip3 pre_avg_users

. duplicates drop

Duplicates in terms of all variables

(3,700 observations deleted)

. gsort -pre_avg_users

. export delimited using "`outdir'/placebo_valid_units.csv", replace
file /Users/jeffreyohl/Dropbox/LLM_PassThrough/output/unique_users/15to25/all_m
> erchants/placebo_valid_units.csv saved

. restore

. 
. * ===========================================================================
. * Run placebos on top quartile units only
. * ===========================================================================
. 
. * Get Chicago's zip3_id ONCE before the loop
. quietly sum zip3_id if zip3 == "606", meanonly

. local chicago_id = r(mean)

. di "Chicago zip3_id = `chicago_id'"
Chicago zip3_id = 544

. 
. local i = 0

. 
. foreach unit of local top_units {
  2.     * Skip Chicago (already have its results)
.     if `unit' == `chicago_id' continue
  3. 
.     * Skip if already completed (incremental mode)
.     local skip = 0
  4.     foreach done of local done_units {
  5.         if `unit' == `done' {
  6.             local skip = 1
  7.             continue, break
  8.         }
  9.     }
 10.     if `skip' == 1 continue
 11. 
.     local ++i
 12. 
.     * Progress every 20 units
.     if mod(`i', 20) == 0 {
 13.         di "Progress: `i'/`n_units' completed"
 14.     }
 15. 
.     di "Placebo `i': zip3_id = `unit'"
 16. 
.     quietly {
 17.         * Load data fresh
.         use "data/synth_panel.dta", clear
 18. 
.         * Balance panel
.         bysort zip3_id: gen n_months = _N
 19.         keep if n_months == 21
 20.         drop n_months
 21. 
.         * Set panel structure
.         tsset zip3_id month_num
 22. 
.         * Create pre-period means
.         bysort zip3_id: egen pre_early_tmp = mean(log_users) if inrange(month
> _num, 3, 6)
 23.         bysort zip3_id: egen pre_mean_early = max(pre_early_tmp)
 24.         drop pre_early_tmp
 25. 
.         bysort zip3_id: egen pre_late_tmp = mean(log_users) if inrange(month_
> num, 7, 9)
 26.         bysort zip3_id: egen pre_mean_late = max(pre_late_tmp)
 27.         drop pre_late_tmp
 28. 
.         * Run synth (with pre_median_price matching)
.         capture synth log_users ///
>             pct_college pct_hh_100k pct_young ///
>             median_age median_income pct_stem pct_broadband ///
>             pre_mean_early pre_mean_late pre_median_price, ///
>             trunit(`unit') trperiod(10) ///
>             keep("`outdir'/placebo_temp", replace)
 29.     }
 30. 
.     if _rc != 0 {
 31.         di "  Failed, skipping"
 32.         continue
 33.     }
 34. 
.     * Compute RMSPE and signed gaps from results
.     quietly {
 35.         use "`outdir'/placebo_temp.dta", clear
 36.         gen gap = _Y_treated - _Y_synthetic
 37.         gen gap_sq = gap^2
 38. 
.         sum gap_sq if _time < 10
 39.         local pre_rmspe = sqrt(r(mean))
 40. 
.         sum gap_sq if _time >= 10
 41.         local post_rmspe = sqrt(r(mean))
 42. 
.         local ratio = `post_rmspe' / `pre_rmspe'
 43. 
.         * Signed gaps
.         sum gap if _time < 10
 44.         local pre_gap = r(mean)
 45. 
.         sum gap if _time >= 10
 46.         local post_gap = r(mean)
 47. 
.         * Final period gap
.         sum gap if _time == 21
 48.         local final_gap = r(mean)
 49. 
.         * Save full series to long dataset
.         gen int zip3_id = `unit'
 50.         rename _time month_num
 51.         rename _Y_treated y_treated
 52.         rename _Y_synthetic y_synthetic
 53.         keep zip3_id month_num y_treated y_synthetic gap
 54.         append using "`outdir'/placebo_series_long.dta"
 55.         save "`outdir'/placebo_series_long.dta", replace
 56.     }
 57. 
.     di "  pre=`pre_rmspe', post=`post_rmspe', ratio=`ratio', post_gap=`post_g
> ap'"
 58.     post `results' (`unit') (`pre_rmspe') (`post_rmspe') (`ratio') ///
>         (`pre_gap') (`post_gap') (`final_gap')
 59. }
Placebo 1: zip3_id = 15
  pre=.0436491928939133, post=.1554811824706187, ratio=3.562063171442969, post_
> gap=-.0758328383755205
Placebo 2: zip3_id = 56
  pre=.035987764276411, post=.0580956800181369, ratio=1.614317565601513, post_g
> ap=.0228057959549395
Placebo 3: zip3_id = 60
  pre=.0714569905216805, post=.0414744015061425, ratio=.5804106946479771, post_
> gap=-.0028867202012667
Placebo 4: zip3_id = 62
  pre=.2727674458551684, post=.4955846450586584, ratio=1.816876070034397, post_
> gap=.4879630208015442
Placebo 5: zip3_id = 65
  pre=.0882230291654956, post=.228220839643384, ratio=2.586862430389572, post_g
> ap=-.1758081018924713
Placebo 6: zip3_id = 66
  pre=.106392903512073, post=.0290610414214579, ratio=.2731483065330591, post_g
> ap=-.0111127576009104
Placebo 7: zip3_id = 69
  pre=.0248065721423879, post=.1712650873543503, ratio=6.904020691424083, post_
> gap=.1636212473469121
Placebo 8: zip3_id = 72
  pre=.0918066861656654, post=.1398232711886542, ratio=1.523018388185178, post_
> gap=.1268000349934612
Placebo 9: zip3_id = 77
  pre=.0273741094578136, post=.1256589294790984, ratio=4.59042986120707, post_g
> ap=.1153909091704658
Placebo 10: zip3_id = 80
  pre=.1260659228560125, post=.2261284213250108, ratio=1.793731535073802, post_
> gap=.2222204336098262
Placebo 11: zip3_id = 82
  pre=.0276470167219906, post=.0729183307467346, ratio=2.637475554052634, post_
> gap=-.0509585409537457
Placebo 12: zip3_id = 87
  pre=.078033161333305, post=.2064171631054441, ratio=2.645249270675698, post_g
> ap=.1975483971514872
Placebo 13: zip3_id = 94
  pre=.0274673807130446, post=.0689705679337267, ratio=2.510999088492327, post_
> gap=-.0369001649918833
Placebo 14: zip3_id = 99
  pre=.0819367217172864, post=.0826115209184963, ratio=1.008235613862344, post_
> gap=-.0380009351730613
Placebo 15: zip3_id = 162
  pre=.0519674571683129, post=.1222587957742359, ratio=2.352603002649571, post_
> gap=-.1074680580557989
Placebo 16: zip3_id = 171
  pre=.0781183156851049, post=.0420870512770578, ratio=.5387603522675886, post_
> gap=-.0100185640289315
Placebo 17: zip3_id = 172
  pre=.3223505568777876, post=.4953903859030678, ratio=1.536806359825476, post_
> gap=.4862796451364245
Placebo 18: zip3_id = 173
  pre=.0376576565496855, post=.0418541295245252, ratio=1.111437443519696, post_
> gap=.0235573022094156
Placebo 19: zip3_id = 174
  pre=.0808651584840078, post=.3216892037368383, ratio=3.97809402426951, post_g
> ap=.3133968391588756
Progress: 20/185 completed
Placebo 20: zip3_id = 175
  pre=.197914053979159, post=.3391529576762063, ratio=1.71363756568758, post_ga
> p=.3291903148804392
Placebo 21: zip3_id = 181
  pre=.048962348437362, post=.1356190479938338, ratio=2.769864034755861, post_g
> ap=.1259072585297482
Placebo 22: zip3_id = 182
  pre=.0320236328203634, post=.046444522382614, ratio=1.450320225789016, post_g
> ap=.0135420726853356
Placebo 23: zip3_id = 184
  pre=.0699351576817824, post=.1008677823187597, ratio=1.442304352522179, post_
> gap=.0796577690468569
Placebo 24: zip3_id = 185
  pre=.0408896175667038, post=.0445696526863813, ratio=1.089999255035198, post_
> gap=-.0413584357260593
Placebo 25: zip3_id = 187
  pre=.0626752892256178, post=.0312961401532154, ratio=.4993377859104233, post_
> gap=.003546330341903
Placebo 26: zip3_id = 189
  pre=.0883776970576888, post=.1043740422164908, ratio=1.180999796230946, post_
> gap=-.0780061800032854
Placebo 27: zip3_id = 196
  pre=.0510633980479685, post=.0382183252151689, ratio=.7484485301833409, post_
> gap=.0175734741081085
Placebo 28: zip3_id = 197
  pre=.0490626792704718, post=.0854097176987675, ratio=1.740828649571346, post_
> gap=.0798266013818128
Placebo 29: zip3_id = 198
  pre=.0504451506412656, post=.0444417159793413, ratio=.8809908467789704, post_
> gap=.0061966228822712
Placebo 30: zip3_id = 199
  pre=.0315736040362563, post=.1688127667386813, ratio=5.346642294773566, post_
> gap=.1573871412713613
Placebo 31: zip3_id = 205
  pre=.103003658976295, post=.0864331441751196, ratio=.8391269303842023, post_g
> ap=.0475289238467147
Placebo 32: zip3_id = 207
  pre=.0479291464172547, post=.2538141280204858, ratio=5.295611271915154, post_
> gap=.229103939291755
Placebo 33: zip3_id = 208
  pre=.2286076692206733, post=.2899931090970843, ratio=1.268518725052728, post_
> gap=.2875641701476915
Placebo 34: zip3_id = 210
  pre=.0425578245075343, post=.0527235272118526, ratio=1.23886800657582, post_g
> ap=.0188531291267801
Placebo 35: zip3_id = 216
  pre=.0285120770645409, post=.0675594186634469, ratio=2.369501825858464, post_
> gap=.042342967087669
Placebo 36: zip3_id = 242
  pre=.3291193826693141, post=.3929553649354068, ratio=1.193959959903767, post_
> gap=.3850839840514319
Placebo 37: zip3_id = 244
  pre=.0443460894108253, post=.0980827454524165, ratio=2.211756363537967, post_
> gap=.0767014096823654
Placebo 38: zip3_id = 245
  pre=.0221665788517258, post=.0276011510398778, ratio=1.245169641400431, post_
> gap=.0194246929271945
Placebo 39: zip3_id = 246
  pre=.0534397584157094, post=.0453080834882139, ratio=.8478347363728898, post_
> gap=-.0393985606663461
Progress: 40/185 completed
Placebo 40: zip3_id = 247
  pre=.0571245251224237, post=.1164931577498477, ratio=2.039284484206931, post_
> gap=.1140617839992046
Placebo 41: zip3_id = 250
  pre=.1162459614354544, post=.1796409497768194, ratio=1.545352178764207, post_
> gap=.1757778961743627
Placebo 42: zip3_id = 251
  pre=.243079518773113, post=.3173800499764411, ratio=1.305663478265642, post_g
> ap=.3138061953442438
Placebo 43: zip3_id = 252
  pre=.0192598793067598, post=.0516016827233877, ratio=2.679231884141487, post_
> gap=.0343483783570783
Placebo 44: zip3_id = 256
  pre=.0381219982615288, post=.1148186704009455, ratio=3.011874393709731, post_
> gap=-.0672485777842147
Placebo 45: zip3_id = 262
  pre=.0325099338033793, post=.0790663558359162, ratio=2.432067573994799, post_
> gap=-.0684249039207186
Placebo 46: zip3_id = 264
  pre=.0632459023458352, post=.0976690535734859, ratio=1.544274805969584, post_
> gap=.0763717618371759
Placebo 47: zip3_id = 265
  pre=.065273736249139, post=.0563956495875067, ratio=.8639868472099388, post_g
> ap=-.0177713957382366
Placebo 48: zip3_id = 266
  pre=.0492369210584668, post=.0955372102640201, ratio=1.940357118402543, post_
> gap=.063575996318832
Placebo 49: zip3_id = 267
  pre=.1390115969132318, post=.1995645329194053, ratio=1.435596290890532, post_
> gap=.1716325144682612
Placebo 50: zip3_id = 270
  pre=.0214337359619855, post=.051121477060887, ratio=2.385094094261269, post_g
> ap=-.0077081414430203
Placebo 51: zip3_id = 271
  pre=.0465026919591823, post=.0340790550239242, ratio=.7328404784358948, post_
> gap=-.0088212006209817
Placebo 52: zip3_id = 272
  pre=.2388952783911062, post=.4901802899439474, ratio=2.051862612125181, post_
> gap=.4778032366718565
Placebo 53: zip3_id = 273
  pre=.0213405628343109, post=.0388001416257748, ratio=1.818140502058023, post_
> gap=.0054178659005889
Placebo 54: zip3_id = 275
  pre=.2386100508358433, post=.2969580561932793, ratio=1.244532890182307, post_
> gap=.2902966865471431
Placebo 55: zip3_id = 289
  pre=.276831423291215, post=.3749882413803063, ratio=1.354572529816582, post_g
> ap=.3738124029976981
Placebo 56: zip3_id = 290
  pre=.0691978410273314, post=.051024507374627, ratio=.7373713777352332, post_g
> ap=.0165502222953364
Placebo 57: zip3_id = 291
  pre=.0325927756220468, post=.0435965193872423, ratio=1.337612969597846, post_
> gap=-.0287759589347323
Placebo 58: zip3_id = 292
  pre=.1314819311156021, post=.0871688671484128, ratio=.6629722153363554, post_
> gap=-.0819520835897752
Placebo 59: zip3_id = 294
  pre=.310146423189661, post=.2787082334970219, ratio=.8986343631845981, post_g
> ap=.2729368507862091
Progress: 60/185 completed
Placebo 60: zip3_id = 295
  pre=.0462423588730206, post=.0848566114417523, ratio=1.835040718289581, post_
> gap=-.0756996415688523
Placebo 61: zip3_id = 296
  pre=.0281658095478705, post=.0304432002214522, ratio=1.080856567240187, post_
> gap=-.0136317403521389
Placebo 62: zip3_id = 297
  pre=.031042394682171, post=.0543924906088268, ratio=1.75220021411772, post_ga
> p=.0126647126126045
Placebo 63: zip3_id = 298
  pre=.0315941318549565, post=.1305624299614663, ratio=4.132489873779634, post_
> gap=.1166353322166417
Placebo 64: zip3_id = 299
  pre=.036832832320559, post=.058486561800197, ratio=1.587892054870609, post_ga
> p=.0465989045000502
Placebo 65: zip3_id = 300
  pre=.0267415757664387, post=.041186616106631, ratio=1.540171621386693, post_g
> ap=.0263757866341621
Placebo 66: zip3_id = 301
  pre=.0450182485430782, post=.1018286942419, ratio=2.261942601886424, post_gap
> =.0978136025369167
Placebo 67: zip3_id = 302
  pre=.0159401115859598, post=.0392614252695754, ratio=2.46305837056732, post_g
> ap=-.0324157019744494
Placebo 68: zip3_id = 303
  pre=.0352976779244156, post=.0481097953559227, ratio=1.362973379125455, post_
> gap=-.0417308700270951
Placebo 69: zip3_id = 304
  pre=.0363190621413335, post=.0613832791286406, ratio=1.690111900185395, post_
> gap=-.0082893995900771
Placebo 70: zip3_id = 305
  pre=.0534479901585524, post=.0386640797446952, ratio=.7233963265971082, post_
> gap=-.0115406170121527
Placebo 71: zip3_id = 306
  pre=.0716990986497295, post=.1786041869393695, ratio=2.491024159339879, post_
> gap=.1427726114301809
Placebo 72: zip3_id = 307
  pre=.0494738214558359, post=.0904585070279099, ratio=1.828411559205307, post_
> gap=.0847310023382306
Placebo 73: zip3_id = 308
  pre=.1454230108539571, post=.0676856315610192, ratio=.4654396244690144, post_
> gap=-.0058330560901335
Placebo 74: zip3_id = 309
  pre=.0875134382029505, post=.0625257270214098, ratio=.714470009467663, post_g
> ap=.0287137822680441
Placebo 75: zip3_id = 311
  pre=.0400925102612181, post=.0861625183989898, ratio=2.149092631955642, post_
> gap=-.0761723571174246
Placebo 76: zip3_id = 312
  pre=.0407578301775694, post=.0313888395150114, ratio=.7701302885423447, post_
> gap=.0083258511066171
Placebo 77: zip3_id = 316
  pre=.0725217657631119, post=.1525377394139723, ratio=2.103337360982465, post_
> gap=.1372055360781295
Placebo 78: zip3_id = 332
  pre=.068734872644042, post=.126026474522243, ratio=1.833515792993429, post_ga
> p=-.1098288985501443
Placebo 79: zip3_id = 334
  pre=.0508465291702189, post=.1199662295320113, ratio=2.35937892890192, post_g
> ap=.0944347670301795
Progress: 80/185 completed
Placebo 80: zip3_id = 452
  pre=.0904312423755617, post=.1010181711214394, ratio=1.117071583534262, post_
> gap=.0291995452716947
Placebo 81: zip3_id = 479
  pre=.1167950742423717, post=.1466457421802222, ratio=1.255581565673778, post_
> gap=.1261492194607854
Placebo 82: zip3_id = 495
  pre=.0300980532855338, post=.0901491652409998, ratio=2.995182591570755, post_
> gap=-.0807217754856018
Placebo 83: zip3_id = 496
  pre=.0280287752612857, post=.0753338160422663, ratio=2.687731281156617, post_
> gap=.054393986539383
Placebo 84: zip3_id = 497
  pre=.0139651204892493, post=.0354457783465864, ratio=2.538164878267499, post_
> gap=-.0264290483402354
Placebo 85: zip3_id = 498
  pre=.0299766949535894, post=.0506766601284512, ratio=1.690535271046723, post_
> gap=.0403891350267388
Placebo 86: zip3_id = 502
  pre=.2143017331891798, post=.2835061092136553, ratio=1.32292961421541, post_g
> ap=.279457617018904
Placebo 87: zip3_id = 538
  pre=.3252578897707822, post=.2963222232384772, ratio=.9110377720500593, post_
> gap=.2946574975337301
Placebo 88: zip3_id = 610
  pre=.2192712565427574, post=.3202694870649309, ratio=1.460608618359785, post_
> gap=.3169987095253808
Placebo 89: zip3_id = 613
  pre=.0474805640891877, post=.1415155370257996, ratio=2.980494013507847, post_
> gap=-.1334971327866827
Placebo 90: zip3_id = 665
  pre=.0357545792884941, post=.0258124086439616, ratio=.7219329427900189, post_
> gap=.0202788647729903
Placebo 91: zip3_id = 666
  pre=.0345648157705148, post=.0576226429654479, ratio=1.66708954411967, post_g
> ap=-.0345373940654099
Placebo 92: zip3_id = 667
  pre=.051770669199531, post=.1012934503121909, ratio=1.956579891246771, post_g
> ap=-.0902030366872038
Placebo 93: zip3_id = 674
  pre=.0229011380489761, post=.0464097337883869, ratio=2.026525218490697, post_
> gap=-.029173327310543
Placebo 94: zip3_id = 675
  pre=.0465162349125178, post=.0637023587128159, ratio=1.369465065962878, post_
> gap=.0220562943390438
Placebo 95: zip3_id = 676
  pre=.3029883598167838, post=.4050255606684368, ratio=1.336769375936932, post_
> gap=.3952962192041533
Placebo 96: zip3_id = 684
  pre=.0334567993283935, post=.0668312968016959, ratio=1.997540055930537, post_
> gap=-.0528805734855788
Placebo 97: zip3_id = 685
  pre=.2303551276618236, post=.294836513757694, ratio=1.279921644247196, post_g
> ap=.285458650972162
Placebo 98: zip3_id = 686
  pre=.224369808644352, post=.3875975195508218, ratio=1.727494095095484, post_g
> ap=.3742605809654508
Placebo 99: zip3_id = 687
  pre=.0213860349018885, post=.0464261080574202, ratio=2.170860950634684, post_
> gap=.0348640648714666
Progress: 100/185 completed
Placebo 100: zip3_id = 692
  pre=.1218853933378289, post=.1276156312991158, ratio=1.047013327884207, post_
> gap=-.1025085707328149
Placebo 101: zip3_id = 693
  pre=.3569161375606904, post=.4209263109252768, ratio=1.179342334594501, post_
> gap=.4181485261235918
Placebo 102: zip3_id = 694
  pre=.0996850160461134, post=.0615153451103571, ratio=.6170972082895653, post_
> gap=.047129384258629
Placebo 103: zip3_id = 697
  pre=.0758535629467939, post=.3020970095492843, ratio=3.982634405204997, post_
> gap=.2883561626076698
Placebo 104: zip3_id = 698
  pre=.0249858443664872, post=.091639025666753, ratio=3.667637736096116, post_g
> ap=-.0898111728685243
Placebo 105: zip3_id = 699
  pre=.0215429833344173, post=.085023978841425, ratio=3.946713299712291, post_g
> ap=-.0743671364949218
Placebo 106: zip3_id = 711
  pre=.0627118408074518, post=.0999135037022847, ratio=1.593215928855534, post_
> gap=.0541583703099085
Placebo 107: zip3_id = 712
  pre=.0303757078339476, post=.0449583197033413, ratio=1.480074800202559, post_
> gap=.0257247561489099
Placebo 108: zip3_id = 713
  pre=.0205531660352777, post=.1032096176608645, ratio=5.021592171430634, post_
> gap=.0945636418515018
Placebo 109: zip3_id = 714
  pre=.0193873936416103, post=.0500067525388813, ratio=2.579343745904763, post_
> gap=-.0366231758588193
Placebo 110: zip3_id = 715
  pre=.0587483004098885, post=.0504250616427449, ratio=.8583237521924526, post_
> gap=-.030543755274266
Placebo 111: zip3_id = 716
  pre=.0469959189998501, post=.0744788236010026, ratio=1.584793428579195, post_
> gap=.0709152441205723
Placebo 112: zip3_id = 717
  pre=.166666011502122, post=.2794757690721729, ratio=1.676861206153089, post_g
> ap=.2755121705787523
Placebo 113: zip3_id = 718
  pre=.0563650639238038, post=.1184642063789649, ratio=2.101731074750644, post_
> gap=-.0729754396847316
Placebo 114: zip3_id = 721
  pre=.037038211849081, post=.0563406590572354, ratio=1.521149543795628, post_g
> ap=-.051661332670067
Placebo 115: zip3_id = 744
  pre=.0709395193830926, post=.0747189903825101, ratio=1.053277369684553, post_
> gap=.0301729959236192
Placebo 116: zip3_id = 745
  pre=.0669735344503076, post=.126341338623382, ratio=1.886436779249326, post_g
> ap=-.1184655538360987
Placebo 117: zip3_id = 747
  pre=.0240649606269543, post=.0406967442438696, ratio=1.691120333614285, post_
> gap=-.026587659717604
Placebo 118: zip3_id = 748
  pre=.0343387014339408, post=.0214050055351275, ratio=.6233493009718336, post_
> gap=-.0100291376999979
Placebo 119: zip3_id = 752
  pre=.0407649831008117, post=.1360111209385183, ratio=3.336469454731851, post_
> gap=-.095721621332424
Progress: 120/185 completed
Placebo 120: zip3_id = 754
  pre=.0247164623016906, post=.0371827268632951, ratio=1.504370909130948, post_
> gap=-.0265465239395521
Placebo 121: zip3_id = 755
  pre=.0554032767569984, post=.0793430187965949, ratio=1.432099750067084, post_
> gap=-.0564409876159126
Placebo 122: zip3_id = 756
  pre=.0187972302243996, post=.0210475628287374, ratio=1.119716180387937, post_
> gap=.0027460376399436
Placebo 123: zip3_id = 757
  pre=.0484188452741752, post=.0628156398299548, ratio=1.297338659653214, post_
> gap=.0495091462700137
Placebo 124: zip3_id = 760
  pre=.0250904653534507, post=.0511868606086757, ratio=2.040092118165355, post_
> gap=.0310214469022217
Placebo 125: zip3_id = 767
  pre=.0516064308680052, post=.0437020574698053, ratio=.8468335580420767, post_
> gap=-.0314720548423273
Placebo 126: zip3_id = 779
  pre=.0223642405218311, post=.0584797260253386, ratio=2.61487645727352, post_g
> ap=-.0391080217169864
Placebo 127: zip3_id = 780
  pre=.0266246635700814, post=.0828873911493334, ratio=3.113180789351848, post_
> gap=-.0781524946380939
Placebo 128: zip3_id = 782
  pre=.1112113529643871, post=.059144626602247, ratio=.5318218421565892, post_g
> ap=.0424876230452875
Placebo 129: zip3_id = 783
  pre=.2414234691154126, post=.321383129963719, ratio=1.331200861048358, post_g
> ap=.3157693733062063
Placebo 130: zip3_id = 786
  pre=.0398126812701187, post=.0532980457712253, ratio=1.33872032907334, post_g
> ap=.010311276435719
Placebo 131: zip3_id = 787
  pre=.0176202726619505, post=.0267813451797268, ratio=1.519916614999884, post_
> gap=-.0064841281023941
Placebo 132: zip3_id = 789
  pre=.113037752831148, post=.1323022598273815, ratio=1.170425424371362, post_g
> ap=-.1212761375520911
Placebo 133: zip3_id = 791
  pre=.0855161970735192, post=.1356782624242312, ratio=1.586579701475583, post_
> gap=.1324826633291585
Placebo 134: zip3_id = 792
  pre=.0621202763594047, post=.0507304985739623, ratio=.8166495957045425, post_
> gap=.0286170288454741
Placebo 135: zip3_id = 793
  pre=.2640911774771101, post=.2855448212287883, ratio=1.081235745762608, post_
> gap=.2829118264572961
Placebo 136: zip3_id = 794
  pre=.0326516110023885, post=.0728581707551306, ratio=2.231380581797356, post_
> gap=.064452113583684
Placebo 137: zip3_id = 795
  pre=.2017015469435753, post=.3678270158115355, ratio=1.823620202151611, post_
> gap=.3653133596692766
Placebo 138: zip3_id = 796
  pre=.0786273818520206, post=.1200411988152842, ratio=1.526709855877, post_gap
> =.0924640594582472
Placebo 139: zip3_id = 797
  pre=.0461048116795649, post=.0255797582611504, ratio=.5548175413649538, post_
> gap=.020429417224867
Progress: 140/185 completed
Placebo 140: zip3_id = 798
  pre=.0638698311999936, post=.1375274845942013, ratio=2.153246407737728, post_
> gap=-.1307815281408174
Placebo 141: zip3_id = 800
  pre=.0583466493931169, post=.0991793188912701, ratio=1.699828866316533, post_
> gap=-.0878874364175967
Placebo 142: zip3_id = 801
  pre=.0353687729923639, post=.042252990710357, ratio=1.194641123668028, post_g
> ap=.0399148703685829
Placebo 143: zip3_id = 803
  pre=.0250404199454894, post=.0697246114239103, ratio=2.784482511702843, post_
> gap=-.0486376478137182
Placebo 144: zip3_id = 804
  pre=.0430909669493856, post=.0206875059149118, ratio=.4800891550939487, post_
> gap=.0120797124358692
Placebo 145: zip3_id = 805
  pre=.0306344471854556, post=.02446909913005, ratio=.7987445956481062, post_ga
> p=-.0017501914096231
Placebo 146: zip3_id = 806
  pre=.0710829476258217, post=.1660287806764005, ratio=2.335704781832776, post_
> gap=.1584150684731347
Placebo 147: zip3_id = 807
  pre=.048047356904987, post=.0266431136493594, ratio=.5545177792411307, post_g
> ap=-.016379470521185
Placebo 148: zip3_id = 809
  pre=.0335897996034078, post=.0396877897355017, ratio=1.18154291493526, post_g
> ap=.0230526296821024
Placebo 149: zip3_id = 810
  pre=.0175228450299813, post=.0137139808090322, ratio=.7826343716198941, post_
> gap=.00270539417813
Placebo 150: zip3_id = 811
  pre=.0712761382850282, post=.0661906180698461, ratio=.9286504524859993, post_
> gap=-.043527872867084
Placebo 151: zip3_id = 812
  pre=.0238221779008395, post=.0371917757833536, ratio=1.561224835872078, post_
> gap=-.0314585315728826
Placebo 152: zip3_id = 813
  pre=.0234236006344471, post=.0469840554535038, ratio=2.005842576756041, post_
> gap=-.0196101050491312
Placebo 153: zip3_id = 814
  pre=.1297353350486581, post=.1990717217411022, ratio=1.534444888637617, post_
> gap=-.1872230795478182
Placebo 154: zip3_id = 816
  pre=.0221875574657937, post=.0730343755876069, ratio=3.291681641848282, post_
> gap=-.0682656428044928
Placebo 155: zip3_id = 817
  pre=.0366073936224458, post=.1558192476154841, ratio=4.25649663077744, post_g
> ap=-.1503400504589081
Placebo 156: zip3_id = 820
  pre=.1051748493246016, post=.1622044526383477, ratio=1.54223613040543, post_g
> ap=-.1521961300500802
Placebo 157: zip3_id = 821
  pre=.0718341455446046, post=.0425153108458477, ratio=.5918537837893303, post_
> gap=-.0147557911030682
Placebo 158: zip3_id = 822
  pre=.0317043880841512, post=.0582299883687167, ratio=1.836653910940027, post_
> gap=-.0431490818570767
Placebo 159: zip3_id = 823
  pre=.0218767612531814, post=.0504839913539193, ratio=2.307653805317171, post_
> gap=-.0438098377448374
Progress: 160/185 completed
Placebo 160: zip3_id = 824
  pre=.0794000251128968, post=.0441999958235802, ratio=.5566748343055735, post_
> gap=.0255263238629725
Placebo 161: zip3_id = 825
  pre=.0585475510838659, post=.1302892826110376, ratio=2.225358365961471, post_
> gap=.115195646615965
Placebo 162: zip3_id = 826
  pre=.2259858490410741, post=.239877022427469, ratio=1.061469217852973, post_g
> ap=.2361845299601555
Placebo 163: zip3_id = 827
  pre=.0344511338940655, post=.0567438316203953, ratio=1.64708168372275, post_g
> ap=.0294631132190781
Placebo 164: zip3_id = 828
  pre=.0155364412950494, post=.0427709613353468, ratio=2.752944546507927, post_
> gap=.0118013336489509
Placebo 165: zip3_id = 830
  pre=.0873294122745165, post=.0818785625323306, ratio=.9375828875951738, post_
> gap=.0785151382109949
Placebo 166: zip3_id = 831
  pre=.0124123270331643, post=.0737378430814943, ratio=5.940694511550922, post_
> gap=-.0686665996909142
Placebo 167: zip3_id = 832
  pre=.0466648661697925, post=.0312894379372203, ratio=.6705138256128729, post_
> gap=.0073334565718791
Placebo 168: zip3_id = 833
  pre=.0708469821859933, post=.0935591119994355, ratio=1.32058006018967, post_g
> ap=.0365898619805064
Placebo 169: zip3_id = 834
  pre=.0342103168888727, post=.0280483438390905, ratio=.819879685131287, post_g
> ap=.0090173748820754
Placebo 170: zip3_id = 835
  pre=.06018744054428, post=.0598729912840578, ratio=.9947755003805012, post_ga
> p=-.0253526756922448
Placebo 171: zip3_id = 837
  pre=.0362738755567103, post=.0669751979669236, ratio=1.846375578540404, post_
> gap=-.0495751401342984
Placebo 172: zip3_id = 838
  pre=.0634677430935624, post=.0480397938039181, ratio=.7569166865300245, post_
> gap=-.0411532450400825
Placebo 173: zip3_id = 839
  pre=.024641801239439, post=.0516231888249304, ratio=2.094943803958126, post_g
> ap=.0334346743100988
Placebo 174: zip3_id = 840
  pre=.0308623251328667, post=.100700613057802, ratio=3.262897809036472, post_g
> ap=-.0800342204914029
Placebo 175: zip3_id = 845
  pre=.1170683951608168, post=.0759988085472682, ratio=.649182970714416, post_g
> ap=.0323014284617135
Placebo 176: zip3_id = 847
  pre=.0279060827941315, post=.1135474936478036, ratio=4.068915529473095, post_
> gap=-.1063840854912996
Placebo 177: zip3_id = 848
  pre=.0561156742908728, post=.1134597876971166, ratio=2.021891194053972, post_
> gap=-.086288773088849
Placebo 178: zip3_id = 849
  pre=.0835573854552439, post=.1253734231995416, ratio=1.500446938549744, post_
> gap=-.0776828046904744
Placebo 179: zip3_id = 855
  pre=.0216834797622457, post=.1039868062339828, ratio=4.795669669913404, post_
> gap=-.0949831035520349
Progress: 180/185 completed
Placebo 180: zip3_id = 856
  pre=.0147813829127202, post=.0418691674154402, ratio=2.832560908723193, post_
> gap=-.0327814620520387
Placebo 181: zip3_id = 857
  pre=.0515654789431277, post=.156170901206048, ratio=3.028594020784547, post_g
> ap=-.1421343297032373
Placebo 182: zip3_id = 858
  pre=.0672184641672123, post=.116027827402562, ratio=1.72613029529999, post_ga
> p=.102939247253484
Placebo 183: zip3_id = 861
  pre=.03204442698561, post=.1970505421185486, ratio=6.149292112698316, post_ga
> p=-.1758846105741603
Placebo 184: zip3_id = 869
  pre=.0904244630286332, post=.0624044493813896, ratio=.69012795090228, post_ga
> p=-.0294432704603033

. 
. postclose `results'

. 
. * ===========================================================================
. * Merge new results if incremental mode
. * ===========================================================================
. if `n_done' > 0 {
.     * Append new results to existing
.     use "`outdir'/placebo_results_topq.dta", clear
.     append using "`outdir'/placebo_results_new.dta"
.     save "`outdir'/placebo_results_topq.dta", replace
.     erase "`outdir'/placebo_results_new.dta"
.     di "Merged new results with existing"
. }

. 
. * ===========================================================================
. * Compute p-value
. * ===========================================================================
. use "`outdir'/placebo_results_topq.dta", clear

. 
. * Filter to good pre-fit (< 5x Chicago)
. local threshold = `chicago_pre_rmspe' * 5

. gen good_fit = (pre_rmspe < `threshold')

. 
. di ""


. di "========================================"
========================================

. di "RESULTS (TOP QUARTILE ONLY, WITH PRICE MATCHING)"
RESULTS (TOP QUARTILE ONLY, WITH PRICE MATCHING)

. di "========================================"
========================================

. count
  185

. di "Total units: " r(N)
Total units: 185

. count if good_fit
  161

. di "Good pre-fit (<5x): " r(N)
Good pre-fit (<5x): 161

. 
. preserve

. keep if good_fit == 1
(24 observations deleted)

. count if ratio >= `chicago_ratio'
  4

. local n_extreme = r(N)

. count
  161

. local n_total = r(N)

. local pvalue = `n_extreme' / `n_total'

. 
. di ""


. di "Chicago ratio: `chicago_ratio'"
Chicago ratio: 5.556646727950006

. di "Units >= Chicago: `n_extreme' / `n_total'"
Units >= Chicago: 4 / 161

. di "P-VALUE: `pvalue'"
P-VALUE: .0248447204968944

. di "========================================"
========================================

. restore

. 
. save "`outdir'/placebo_results_topq.dta", replace
file
    /Users/jeffreyohl/Dropbox/LLM_PassThrough/output/unique_users/15to25/all_
    > merchants/placebo_results_topq.dta saved

. 
end of do-file
