
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 19.5
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2025 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: 22-user 8-core network, expiring 30 Jun 2026
Serial number: 501909306443
  Licensed to: Jeffrey Ohl
               University of Chicago

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.

. do chicago_synth_placebo_topq.do 

. /*
> Placebo tests - TOP QUARTILE ONLY (by pre-treatment outcome)
> Filters out noisy small ZIP3s that produce meaningless placebo ratios.
> Includes pre_median_price matching.
> 
> Outcome: Set by $outcome_var from data/synth_config.do
> 
> INCREMENTAL: Resumes if main synth unchanged. Restarts if main synth is newer
> .
> */
. 
. clear all

. set more off

. 
. * Load config (outcome_var, outcome_label, outdir from Python)
. include "data/synth_config.do"

. * Auto-generated by export_synth_data.py
. * DO NOT EDIT - change settings in load_chatgpt_data.py
. 
. global outcome_var "log_trans"

. global outcome_label "Log Transactions"

. global outdir "/Users/jeffreyohl/Dropbox/LLM_PassThrough/output/trans/15to25/
> all_merchants"

. 
. 
. * ===========================================================================
. * Smart resume: restart if main synth changed
. * ===========================================================================
. local main_synth "$outdir/chicago_synth_stata.png"

. local placebo_file "$outdir/placebo_results_topq.dta"

. 
. capture confirm file "`main_synth'"

. local main_exists = (_rc == 0)

. 
. capture confirm file "`placebo_file'"

. local placebo_exists = (_rc == 0)

. 
. if `main_exists' & `placebo_exists' {
.     quietly shell stat -f "%m" "`main_synth'" > /tmp/main_mtime.txt
.     quietly shell stat -f "%m" "`placebo_file'" > /tmp/placebo_mtime.txt
. 
.     file open main_f using "/tmp/main_mtime.txt", read
.     file read main_f main_mtime
.     file close main_f
. 
.     file open placebo_f using "/tmp/placebo_mtime.txt", read
.     file read placebo_f placebo_mtime
.     file close placebo_f
. 
.     if `main_mtime' > `placebo_mtime' {
.         di "WARNING: Main synth is newer than placebo results"
.         di "RESTARTING FRESH (deleting old placebo results)"
.         erase "`placebo_file'"
.         capture erase "$outdir/placebo_series_long.dta"
.     }
. }

. 
. * ===========================================================================
. * Check for existing results (incremental mode)
. * ===========================================================================
. local done_units ""

. capture confirm file "$outdir/placebo_results_topq.dta"

. if _rc == 0 {
.     use "$outdir/placebo_results_topq.dta", clear
.     count
  0
.     local n_done = r(N)
.     di "INCREMENTAL MODE: Found `n_done' completed units"
INCREMENTAL MODE: Found 0 completed units
.     levelsof zip3_id, local(done_units)

. }

. else {
.     di "FRESH START: No existing results found"
.     local n_done = 0
. }

. 
. * Create output file for summary results (append mode if exists)
. tempname results

. if `n_done' > 0 {
.     * Append to existing file
.     postfile `results' int(zip3_id) double(pre_rmspe post_rmspe ratio ///
>         pre_gap_mean post_gap_mean final_gap) ///
>         using "$outdir/placebo_results_new.dta", replace
. }

. else {
.     * Fresh start
.     postfile `results' int(zip3_id) double(pre_rmspe post_rmspe ratio ///
>         pre_gap_mean post_gap_mean final_gap) ///
>         using "$outdir/placebo_results_topq.dta", replace
. 
.     * Create empty dataset for full series (long format)
.     clear
.     gen int zip3_id = .
.     gen int month_num = .
.     gen double y_treated = .
.     gen double y_synthetic = .
.     gen double gap = .
.     save "$outdir/placebo_series_long.dta", replace
(dataset contains 0 observations)
file
    /Users/jeffreyohl/Dropbox/LLM_PassThrough/output/trans/15to25/all_merchan
    > ts/placebo_series_long.dta saved
. }

. 
. * ===========================================================================
. * First: Get Chicago's RMSPE from already-computed results
. * ===========================================================================
. use "$outdir/synth_results.dta", clear

. gen gap = _Y_treated - _Y_synthetic
(712 missing values generated)

. gen gap_sq = gap^2
(712 missing values generated)

. 
. sum gap_sq if _time < 10

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      gap_sq |          7    .0001957    .0003135   2.05e-07   .0008117

. local chicago_pre_rmspe = sqrt(r(mean))

. 
. sum gap_sq if _time >= 10

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      gap_sq |         14    .0156909    .0161203   1.46e-06   .0501989

. local chicago_post_rmspe = sqrt(r(mean))

. 
. local chicago_ratio = `chicago_post_rmspe' / `chicago_pre_rmspe'

. 
. * Signed gaps
. sum gap if _time < 10

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         gap |          7     -.00083    .0150819  -.0208025   .0284912

. local chicago_pre_gap = r(mean)

. 
. sum gap if _time >= 10

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         gap |         14   -.1023477    .0749474  -.2240511   .0259597

. local chicago_post_gap = r(mean)

. 
. * Final period gap (month 21)
. sum gap if _time == 21

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         gap |          1   -.1894422           .  -.1894422  -.1894422

. local chicago_final_gap = r(mean)

. 
. di "Chicago: pre_rmspe=`chicago_pre_rmspe', post_rmspe=`chicago_post_rmspe', 
> ratio=`chicago_ratio'"
Chicago: pre_rmspe=.01398780356318, post_rmspe=.125263470941695, ratio=8.955192
> 312782057

. di "  pre_gap=`chicago_pre_gap', post_gap=`chicago_post_gap', final_gap=`chic
> ago_final_gap'"
  pre_gap=-.0008299939134823, post_gap=-.1023476971396511, final_gap=-.18944221
> 73500061

. post `results' (606) (`chicago_pre_rmspe') (`chicago_post_rmspe') (`chicago_r
> atio') ///
>     (`chicago_pre_gap') (`chicago_post_gap') (`chicago_final_gap')

. 
. * Add Chicago's series to long dataset
. use "$outdir/synth_results.dta", clear

. gen int zip3_id = 606

. gen gap = _Y_treated - _Y_synthetic
(712 missing values generated)

. rename _time month_num

. rename _Y_treated y_treated

. rename _Y_synthetic y_synthetic

. keep zip3_id month_num y_treated y_synthetic gap

. append using "$outdir/placebo_series_long.dta"
(variable gap was float, now double to accommodate using data's values)

. save "$outdir/placebo_series_long.dta", replace
file
    /Users/jeffreyohl/Dropbox/LLM_PassThrough/output/trans/15to25/all_merchan
    > ts/placebo_series_long.dta saved

. 
. * ===========================================================================
. * Identify TOP QUARTILE units by pre-period usage
. * ===========================================================================
. use "data/synth_panel.dta", clear

. 
. * Balance panel first
. bysort zip3_id: gen n_months = _N

. keep if n_months == 21
(2,071 observations deleted)

. drop n_months

. 
. * Compute pre-period mean $outcome_var by unit
. bysort zip3_id: egen pre_mean_log = mean($outcome_var) if month_num < 10
(10,276 missing values generated)

. bysort zip3_id: egen pre_avg_log = max(pre_mean_log)

. drop pre_mean_log

. 
. * Convert to level (exp of log)
. gen pre_avg_outcome = exp(pre_avg_log)

. 
. * Get 75th percentile
. quietly sum pre_avg_outcome, detail

. local q75 = r(p75)

. di "Top quartile threshold: `q75' ($outcome_label)"
Top quartile threshold: 49.79880142211914 (Log Transactions)

. 
. * Keep only top quartile
. keep if pre_avg_outcome >= `q75'
(11,550 observations deleted)

. 
. * Get list of qualifying units
. levelsof zip3_id, local(top_units)
15 56 60 62 65 66 69 72 77 80 82 87 94 99 162 171 172 173 174 175 181 182 184 1
> 85 187 189 196 197 198 199 205 207 208 210 216 243 246 247 248 251 252 253 25
> 7 258 261 263 265 266 267 268 271 272 273 274 276 277 290 291 292 293 295 296
>  297 298 299 300 301 302 303 304 305 306 307 308 310 312 313 314 317 333 335 
> 480 481 497 498 499 500 504 546 613 616 668 669 670 677 678 679 687 688 689 6
> 90 695 696 697 700 701 702 714 715 716 717 718 719 720 724 747 748 750 751 75
> 5 757 758 759 760 763 770 782 783 785 786 789 790 792 794 795 796 797 798 799
>  800 801 803 804 806 807 808 809 810 812 813 814 815 816 817 819 820 823 824 
> 825 826 827 828 829 830 831 833 834 835 837 838 840 841 842 843 848 850 851 8
> 52 858 859 860 861 863 864

. local n_units : word count `top_units'

. di "Top quartile units: `n_units'"
Top quartile units: 184

. 
. * Save to file for reference
. preserve

. keep zip3_id zip3 pre_avg_outcome

. duplicates drop

Duplicates in terms of all variables

(3,680 observations deleted)

. gsort -pre_avg_outcome

. export delimited using "$outdir/placebo_valid_units.csv", replace
file /Users/jeffreyohl/Dropbox/LLM_PassThrough/output/trans/15to25/all_merchant
> s/placebo_valid_units.csv saved

. restore

. 
. * ===========================================================================
. * Run placebos on top quartile units only
. * ===========================================================================
. 
. * Get Chicago's zip3_id ONCE before the loop
. quietly sum zip3_id if zip3 == "606", meanonly

. local chicago_id = r(mean)

. di "Chicago zip3_id = `chicago_id'"
Chicago zip3_id = 546

. 
. local i = 0

. 
. foreach unit of local top_units {
  2.     * Skip Chicago (already have its results)
.     if `unit' == `chicago_id' continue
  3. 
.     * Skip if already completed (incremental mode)
.     local skip = 0
  4.     foreach done of local done_units {
  5.         if `unit' == `done' {
  6.             local skip = 1
  7.             continue, break
  8.         }
  9.     }
 10.     if `skip' == 1 continue
 11. 
.     local ++i
 12. 
.     * Progress every 20 units
.     if mod(`i', 20) == 0 {
 13.         di "Progress: `i'/`n_units' completed"
 14.     }
 15. 
.     di "Placebo `i': zip3_id = `unit'"
 16. 
.     quietly {
 17.         * Load data fresh
.         use "data/synth_panel.dta", clear
 18. 
.         * Balance panel
.         bysort zip3_id: gen n_months = _N
 19.         keep if n_months == 21
 20.         drop n_months
 21. 
.         * Set panel structure
.         tsset zip3_id month_num
 22. 
.         * Create pre-period means
.         bysort zip3_id: egen pre_early_tmp = mean($outcome_var) if inrange(mo
> nth_num, 3, 6)
 23.         bysort zip3_id: egen pre_mean_early = max(pre_early_tmp)
 24.         drop pre_early_tmp
 25. 
.         bysort zip3_id: egen pre_late_tmp = mean($outcome_var) if inrange(mon
> th_num, 7, 9)
 26.         bysort zip3_id: egen pre_mean_late = max(pre_late_tmp)
 27.         drop pre_late_tmp
 28. 
.         * Run synth (with pre_median_price matching)
.         capture synth $outcome_var ///
>             pct_college pct_hh_100k pct_young ///
>             median_age median_income pct_stem pct_broadband ///
>             pre_mean_early pre_mean_late pre_median_price, ///
>             trunit(`unit') trperiod(10) ///
>             keep("$outdir/placebo_temp", replace)
 29.     }
 30. 
.     if _rc != 0 {
 31.         di "  Failed, skipping"
 32.         continue
 33.     }
 34. 
.     * Compute RMSPE and signed gaps from results
.     quietly {
 35.         use "$outdir/placebo_temp.dta", clear
 36.         gen gap = _Y_treated - _Y_synthetic
 37.         gen gap_sq = gap^2
 38. 
.         sum gap_sq if _time < 10
 39.         local pre_rmspe = sqrt(r(mean))
 40. 
.         sum gap_sq if _time >= 10
 41.         local post_rmspe = sqrt(r(mean))
 42. 
.         local ratio = `post_rmspe' / `pre_rmspe'
 43. 
.         * Signed gaps
.         sum gap if _time < 10
 44.         local pre_gap = r(mean)
 45. 
.         sum gap if _time >= 10
 46.         local post_gap = r(mean)
 47. 
.         * Final period gap
.         sum gap if _time == 21
 48.         local final_gap = r(mean)
 49. 
.         * Save full series to long dataset
.         gen int zip3_id = `unit'
 50.         rename _time month_num
 51.         rename _Y_treated y_treated
 52.         rename _Y_synthetic y_synthetic
 53.         keep zip3_id month_num y_treated y_synthetic gap
 54.         append using "$outdir/placebo_series_long.dta"
 55.         save "$outdir/placebo_series_long.dta", replace
 56.     }
 57. 
.     di "  pre=`pre_rmspe', post=`post_rmspe', ratio=`ratio', post_gap=`post_g
> ap'"
 58.     post `results' (`unit') (`pre_rmspe') (`post_rmspe') (`ratio') ///
>         (`pre_gap') (`post_gap') (`final_gap')
 59. }
Placebo 1: zip3_id = 15
  pre=.0342176159424782, post=.1550054021714308, ratio=4.529988367161637, post_
> gap=-.0655120137214128
Placebo 2: zip3_id = 56
  pre=.038445245072834, post=.0552631824521588, ratio=1.43745168869293, post_ga
> p=-.0170336098942373
Placebo 3: zip3_id = 60
  pre=.1186817008196014, post=.0597090675556463, ratio=.5031025604057132, post_
> gap=.0038337660288172
Placebo 4: zip3_id = 62
  pre=.2625837387922729, post=.4628491909114941, ratio=1.762672711723588, post_
> gap=.4544775060244969
Placebo 5: zip3_id = 65
  pre=.0288050383047651, post=.081097131981608, ratio=2.815380112450412, post_g
> ap=-.0448816750597741
Placebo 6: zip3_id = 66
  pre=.2108964852821046, post=.0626039453154667, ratio=.2968467930213481, post_
> gap=-.0368252759674631
Placebo 7: zip3_id = 69
  pre=.0308073928873804, post=.1796167428521729, ratio=5.830312987170982, post_
> gap=.1667076945304871
Placebo 8: zip3_id = 72
  pre=.0686732990807574, post=.0477932073372758, ratio=.6959503617420894, post_
> gap=-.012591791052338
Placebo 9: zip3_id = 77
  pre=.0238156646387153, post=.0743713916427514, ratio=3.122793034373331, post_
> gap=.0547774267116828
Placebo 10: zip3_id = 80
  pre=.1937096287268272, post=.266230572091467, ratio=1.374379651859795, post_g
> ap=.2625392121928079
Placebo 11: zip3_id = 82
  pre=.0173552666883899, post=.0649357921191448, ratio=3.741561180536897, post_
> gap=-.0432202679221518
Placebo 12: zip3_id = 87
  pre=.0674800246461848, post=.0788040102987203, ratio=1.167812411330762, post_
> gap=.0682648989812671
Placebo 13: zip3_id = 94
  pre=.0309841243050113, post=.0543233996034045, ratio=1.753265610111768, post_
> gap=-.0004429305554368
Placebo 14: zip3_id = 99
  pre=.1319254558805109, post=.2251027633930548, ratio=1.70628755376019, post_g
> ap=-.1883986103348434
Placebo 15: zip3_id = 162
  pre=.0619730097912242, post=.1503160937036763, ratio=2.425509011262546, post_
> gap=-.1249681343989713
Placebo 16: zip3_id = 171
  pre=.029077630221478, post=.140328014331268, ratio=4.825978364207122, post_ga
> p=-.1302688233554363
Placebo 17: zip3_id = 172
  pre=.3377805990608088, post=.5153774285368459, ratio=1.525775695732203, post_
> gap=.5050687087433678
Placebo 18: zip3_id = 173
  pre=.0469960753149417, post=.041282655041446, ratio=.8784277147568702, post_g
> ap=.0141793983576853
Placebo 19: zip3_id = 174
  pre=.0689489572674891, post=.2937803099526199, ratio=4.260837605025588, post_
> gap=.2877258828708104
Progress: 20/184 completed
Placebo 20: zip3_id = 175
  pre=.1974945109621649, post=.4124448856183799, ratio=2.088386576462341, post_
> gap=.3988688598786082
Placebo 21: zip3_id = 181
  pre=.0407983957477802, post=.1047579507876238, ratio=2.567697794669379, post_
> gap=.0937161180855972
Placebo 22: zip3_id = 182
  pre=.0268172790687225, post=.0620643108739383, ratio=2.314340344331394, post_
> gap=.0415789443400821
Placebo 23: zip3_id = 184
  pre=.1051380319820005, post=.0765817021296564, ratio=.7283920070214658, post_
> gap=.0267475517466664
Placebo 24: zip3_id = 185
  pre=.0351941844766846, post=.0388016562806884, ratio=1.102501929158031, post_
> gap=-.0307050551553922
Placebo 25: zip3_id = 187
  pre=.0568578483463976, post=.0309823588262156, ratio=.5449090974646174, post_
> gap=-.0015823765383435
Placebo 26: zip3_id = 189
  pre=.0790656200956278, post=.0733457616912225, ratio=.9276568197721428, post_
> gap=-.0439852675689118
Placebo 27: zip3_id = 196
  pre=.0428068902192781, post=.0505138363414983, ratio=1.180039850658186, post_
> gap=-.0361077609205885
Placebo 28: zip3_id = 197
  pre=.0472617630121173, post=.064693622503131, ratio=1.368836420396429, post_g
> ap=.0519827110089994
Placebo 29: zip3_id = 198
  pre=.0394961825286711, post=.0575641295359474, ratio=1.457460591138407, post_
> gap=-.0251251847948879
Placebo 30: zip3_id = 199
  pre=.0400102227798506, post=.1669179337455441, ratio=4.171882137822162, post_
> gap=.1443349812179804
Placebo 31: zip3_id = 205
  Failed, skipping
Placebo 32: zip3_id = 207
  Failed, skipping
Placebo 33: zip3_id = 208
  Failed, skipping
Placebo 34: zip3_id = 210
  Failed, skipping
Placebo 35: zip3_id = 216
  Failed, skipping
Placebo 36: zip3_id = 243
  Failed, skipping
Placebo 37: zip3_id = 246
  Failed, skipping
Placebo 38: zip3_id = 247
  Failed, skipping
Placebo 39: zip3_id = 248
  Failed, skipping
Progress: 40/184 completed
Placebo 40: zip3_id = 251
  Failed, skipping
Placebo 41: zip3_id = 252
  Failed, skipping
Placebo 42: zip3_id = 253
  Failed, skipping
Placebo 43: zip3_id = 257
  Failed, skipping
Placebo 44: zip3_id = 258
  Failed, skipping
Placebo 45: zip3_id = 261
  Failed, skipping
Placebo 46: zip3_id = 263
  Failed, skipping
Placebo 47: zip3_id = 265
  Failed, skipping
Placebo 48: zip3_id = 266
  Failed, skipping
Placebo 49: zip3_id = 267
  Failed, skipping
Placebo 50: zip3_id = 268
  Failed, skipping
Placebo 51: zip3_id = 271
  Failed, skipping
Placebo 52: zip3_id = 272
  Failed, skipping
Placebo 53: zip3_id = 273
  Failed, skipping
Placebo 54: zip3_id = 274
  Failed, skipping
Placebo 55: zip3_id = 276
  Failed, skipping
Placebo 56: zip3_id = 277
  Failed, skipping
Placebo 57: zip3_id = 290
  Failed, skipping
Placebo 58: zip3_id = 291
  Failed, skipping
Placebo 59: zip3_id = 292
  Failed, skipping
Progress: 60/184 completed
Placebo 60: zip3_id = 293
  Failed, skipping
Placebo 61: zip3_id = 295
  Failed, skipping
Placebo 62: zip3_id = 296
  Failed, skipping
Placebo 63: zip3_id = 297
  Failed, skipping
Placebo 64: zip3_id = 298
  Failed, skipping
Placebo 65: zip3_id = 299
  Failed, skipping
Placebo 66: zip3_id = 300
  Failed, skipping
Placebo 67: zip3_id = 301
  Failed, skipping
Placebo 68: zip3_id = 302
  Failed, skipping
Placebo 69: zip3_id = 303
  Failed, skipping
Placebo 70: zip3_id = 304
  Failed, skipping
Placebo 71: zip3_id = 305
  Failed, skipping
Placebo 72: zip3_id = 306
  Failed, skipping
Placebo 73: zip3_id = 307
  Failed, skipping
Placebo 74: zip3_id = 308
  Failed, skipping
Placebo 75: zip3_id = 310
  Failed, skipping
Placebo 76: zip3_id = 312
  Failed, skipping
Placebo 77: zip3_id = 313
  Failed, skipping
Placebo 78: zip3_id = 314
  Failed, skipping
Placebo 79: zip3_id = 317
  Failed, skipping
Progress: 80/184 completed
Placebo 80: zip3_id = 333
  Failed, skipping
Placebo 81: zip3_id = 335
  Failed, skipping
Placebo 82: zip3_id = 480
  Failed, skipping
Placebo 83: zip3_id = 481
  Failed, skipping
Placebo 84: zip3_id = 497
  Failed, skipping
Placebo 85: zip3_id = 498
  Failed, skipping
Placebo 86: zip3_id = 499
  Failed, skipping
Placebo 87: zip3_id = 500
  Failed, skipping
Placebo 88: zip3_id = 504
  Failed, skipping
Placebo 89: zip3_id = 613
  Failed, skipping
Placebo 90: zip3_id = 616
  Failed, skipping
Placebo 91: zip3_id = 668
  Failed, skipping
Placebo 92: zip3_id = 669
  Failed, skipping
Placebo 93: zip3_id = 670
  Failed, skipping
Placebo 94: zip3_id = 677
  Failed, skipping
Placebo 95: zip3_id = 678
  Failed, skipping
Placebo 96: zip3_id = 679
  Failed, skipping
Placebo 97: zip3_id = 687
  Failed, skipping
Placebo 98: zip3_id = 688
  Failed, skipping
Placebo 99: zip3_id = 689
  Failed, skipping
Progress: 100/184 completed
Placebo 100: zip3_id = 690
  Failed, skipping
Placebo 101: zip3_id = 695
  Failed, skipping
Placebo 102: zip3_id = 696
  Failed, skipping
Placebo 103: zip3_id = 697
  Failed, skipping
Placebo 104: zip3_id = 700
  Failed, skipping
Placebo 105: zip3_id = 701
  Failed, skipping
Placebo 106: zip3_id = 702
  Failed, skipping
Placebo 107: zip3_id = 714
  Failed, skipping
Placebo 108: zip3_id = 715
  Failed, skipping
Placebo 109: zip3_id = 716
  Failed, skipping
Placebo 110: zip3_id = 717
  Failed, skipping
Placebo 111: zip3_id = 718
  Failed, skipping
Placebo 112: zip3_id = 719
  Failed, skipping
Placebo 113: zip3_id = 720
  Failed, skipping
Placebo 114: zip3_id = 724
  Failed, skipping
Placebo 115: zip3_id = 747
  Failed, skipping
Placebo 116: zip3_id = 748
  Failed, skipping
Placebo 117: zip3_id = 750
  Failed, skipping
Placebo 118: zip3_id = 751
  Failed, skipping
Placebo 119: zip3_id = 755
  Failed, skipping
Progress: 120/184 completed
Placebo 120: zip3_id = 757
  Failed, skipping
Placebo 121: zip3_id = 758
  Failed, skipping
Placebo 122: zip3_id = 759
  Failed, skipping
Placebo 123: zip3_id = 760
  Failed, skipping
Placebo 124: zip3_id = 763
  Failed, skipping
Placebo 125: zip3_id = 770
  Failed, skipping
Placebo 126: zip3_id = 782
  Failed, skipping
Placebo 127: zip3_id = 783
  Failed, skipping
Placebo 128: zip3_id = 785
  Failed, skipping
Placebo 129: zip3_id = 786
  Failed, skipping
Placebo 130: zip3_id = 789
  Failed, skipping
Placebo 131: zip3_id = 790
  Failed, skipping
Placebo 132: zip3_id = 792
  Failed, skipping
Placebo 133: zip3_id = 794
  Failed, skipping
Placebo 134: zip3_id = 795
  Failed, skipping
Placebo 135: zip3_id = 796
  Failed, skipping
Placebo 136: zip3_id = 797
  Failed, skipping
Placebo 137: zip3_id = 798
  Failed, skipping
Placebo 138: zip3_id = 799
  Failed, skipping
Placebo 139: zip3_id = 800
  Failed, skipping
Progress: 140/184 completed
Placebo 140: zip3_id = 801
  Failed, skipping
Placebo 141: zip3_id = 803
  Failed, skipping
Placebo 142: zip3_id = 804
  Failed, skipping
Placebo 143: zip3_id = 806
  Failed, skipping
Placebo 144: zip3_id = 807
  Failed, skipping
Placebo 145: zip3_id = 808
  Failed, skipping
Placebo 146: zip3_id = 809
  Failed, skipping
Placebo 147: zip3_id = 810
  Failed, skipping
Placebo 148: zip3_id = 812
  Failed, skipping
Placebo 149: zip3_id = 813
  Failed, skipping
Placebo 150: zip3_id = 814
  Failed, skipping
Placebo 151: zip3_id = 815
  Failed, skipping
Placebo 152: zip3_id = 816
  Failed, skipping
Placebo 153: zip3_id = 817
  Failed, skipping
Placebo 154: zip3_id = 819
  Failed, skipping
Placebo 155: zip3_id = 820
  Failed, skipping
Placebo 156: zip3_id = 823
  Failed, skipping
Placebo 157: zip3_id = 824
  Failed, skipping
Placebo 158: zip3_id = 825
  Failed, skipping
Placebo 159: zip3_id = 826
  Failed, skipping
Progress: 160/184 completed
Placebo 160: zip3_id = 827
  Failed, skipping
Placebo 161: zip3_id = 828
  pre=.0882327469166412, post=.0400285726686032, ratio=.4536702535898673, post_
> gap=.0256841308686749
Placebo 162: zip3_id = 829
  pre=.2416227332523992, post=.2371579495297952, ratio=.9815216736334983, post_
> gap=.2366628050804138
Placebo 163: zip3_id = 830
  pre=.0358609476421837, post=.044395683500789, ratio=1.237995268383978, post_g
> ap=-.0147778881447656
Placebo 164: zip3_id = 831
  pre=.0263925426621907, post=.0466579106190873, ratio=1.76784447092808, post_g
> ap=.0030169810966722
Placebo 165: zip3_id = 833
  pre=.0780930698492277, post=.04836632512616, ratio=.619342090399822, post_gap
> =.0272508218851207
Placebo 166: zip3_id = 834
  pre=.0170006568030208, post=.0781077077866426, ratio=4.594393539710999, post_
> gap=-.0725483922953052
Placebo 167: zip3_id = 835
  pre=.0313285686523638, post=.0448106361428934, ratio=1.430344189679803, post_
> gap=-.0259133490534233
Placebo 168: zip3_id = 837
  pre=.0313402053701521, post=.0387579785550198, ratio=1.236685532122654, post_
> gap=-.0236375149023453
Placebo 169: zip3_id = 838
  pre=.0614782104153849, post=.0757095934619091, ratio=1.231486618598169, post_
> gap=.04304150012987
Placebo 170: zip3_id = 840
  pre=.0432445933121851, post=.0822287009707112, ratio=1.9014793451079, post_ga
> p=-.0627990321788405
Placebo 171: zip3_id = 841
  pre=.0660516664199455, post=.0565246547953063, ratio=.8557642503056918, post_
> gap=-.0465684631573302
Placebo 172: zip3_id = 842
  pre=.0243023185336355, post=.0740102704129493, ratio=3.045399570025213, post_
> gap=.0640502738034619
Placebo 173: zip3_id = 843
  pre=.0488870922840658, post=.0946384144786424, ratio=1.935856890991423, post_
> gap=-.0813132974518729
Placebo 174: zip3_id = 848
  pre=.082849617230295, post=.0814251777323285, ratio=.9828069272304901, post_g
> ap=-.0463410086064999
Placebo 175: zip3_id = 850
  pre=.0285222846994716, post=.1485900285150623, ratio=5.209611715214913, post_
> gap=-.138231957597392
Placebo 176: zip3_id = 851
  pre=.0886871761445741, post=.0710897634887088, ratio=.8015788367511134, post_
> gap=-.0174298358948103
Placebo 177: zip3_id = 852
  pre=.1133469183918788, post=.0860035723656828, ratio=.7587640986263009, post_
> gap=.0630730178340205
Placebo 178: zip3_id = 858
  pre=.0310496864546291, post=.1511742148459419, ratio=4.868783943014787, post_
> gap=-.139264389872551
Placebo 179: zip3_id = 859
  pre=.0194273814026927, post=.0292461069808441, ratio=1.505406538052035, post_
> gap=-.0151677827317534
Progress: 180/184 completed
Placebo 180: zip3_id = 860
  pre=.0409657799047791, post=.0689955669926393, ratio=1.684224422262012, post_
> gap=.0448709892828317
Placebo 181: zip3_id = 861
  pre=.0766930543988597, post=.0901485054634657, ratio=1.175445497249697, post_
> gap=.0720322416829211
Placebo 182: zip3_id = 863
  pre=.0550646095365892, post=.0988271940844847, ratio=1.794749747908704, post_
> gap=-.0767747331410646
Placebo 183: zip3_id = 864
  pre=.033568187212487, post=.1896669475062025, ratio=5.650199288558795, post_g
> ap=-.166252664955599

. 
. postclose `results'

. 
. * ===========================================================================
. * Merge new results if incremental mode
. * ===========================================================================
. if `n_done' > 0 {
.     * Append new results to existing
.     use "$outdir/placebo_results_topq.dta", clear
.     append using "$outdir/placebo_results_new.dta"
.     save "$outdir/placebo_results_topq.dta", replace
.     erase "$outdir/placebo_results_new.dta"
.     di "Merged new results with existing"
. }

. 
. * ===========================================================================
. * Compute p-value
. * ===========================================================================
. use "$outdir/placebo_results_topq.dta", clear

. 
. * Filter to good pre-fit (< 5x Chicago)
. local threshold = `chicago_pre_rmspe' * 5

. gen good_fit = (pre_rmspe < `threshold')

. 
. di ""


. di "========================================"
========================================

. di "RESULTS (TOP QUARTILE ONLY, WITH PRICE MATCHING)"
RESULTS (TOP QUARTILE ONLY, WITH PRICE MATCHING)

. di "========================================"
========================================

. count
  54

. di "Total units: " r(N)
Total units: 54

. count if good_fit
  38

. di "Good pre-fit (<5x): " r(N)
Good pre-fit (<5x): 38

. 
. preserve

. keep if good_fit == 1
(16 observations deleted)

. count if ratio >= `chicago_ratio'
  1

. local n_extreme = r(N)

. count
  38

. local n_total = r(N)

. local pvalue = `n_extreme' / `n_total'

. 
. di ""


. di "Chicago ratio: `chicago_ratio'"
Chicago ratio: 8.955192312782057

. di "Units >= Chicago: `n_extreme' / `n_total'"
Units >= Chicago: 1 / 38

. di "P-VALUE: `pvalue'"
P-VALUE: .0263157894736842

. di "========================================"
========================================

. restore

. 
. save "$outdir/placebo_results_topq.dta", replace
file
    /Users/jeffreyohl/Dropbox/LLM_PassThrough/output/trans/15to25/all_merchan
    > ts/placebo_results_topq.dta saved

. 
end of do-file
