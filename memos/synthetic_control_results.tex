\documentclass[11pt]{article}
\usepackage[margin=1in]{geometry}
\usepackage{booktabs}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{xcolor}

% See zip3_fixes.md for ZIP3 assignment methodology and known limitations.

% Auto-generated results (run code/export_synth_results_tex.py to update)
\input{synth_macros.tex}
\input{/Users/jeffreyohl/Dropbox/LLM_PassThrough/output/exploratory/trans_user_macros.tex}

% Figure path prefix
% NOTE: Update these when changing OUTCOME_VAR in load_chatgpt_data.py
% unique_users â†’ trans (or vice versa)
\newcommand{\figpath}{/Users/jeffreyohl/Dropbox/LLM_PassThrough/output/trans/15to25/all_merchants}
\newcommand{\exploratorypath}{/Users/jeffreyohl/Dropbox/LLM_PassThrough/output/trans/15to25/all_merchants/exploratory}

\title{Synthetic Control Analysis: Chicago PPLTT on ChatGPT Subscriptions}
\date{January 2026}

\begin{document}
\maketitle

\section{Method}

We estimate the effect of Chicago's 9\% Personal Property Lease Transaction
Tax (PPLTT) on ChatGPT subscriptions using synthetic control. The method
constructs a weighted average of untreated ZIP3s to match Chicago on
pre-treatment characteristics, then compares actual vs.\ synthetic outcomes
post-treatment.

\textbf{Matching variables:}

\begin{itemize}
    \item \textbf{Demographics (7 covariates):}
    \begin{itemize}
        \item \texttt{pct\_college}: \% with bachelor's degree or higher
        \item \texttt{pct\_hh\_100k}: \% households earning \$100k+
        \item \texttt{pct\_young}: \% aged 18--34
        \item \texttt{median\_age}: median age
        \item \texttt{median\_income}: median household income
        \item \texttt{pct\_stem}: \% in STEM occupations
        \item \texttt{pct\_broadband}: \% with broadband internet
    \end{itemize}
    \item \textbf{Pre-treatment outcomes (3 scalars):}
    \begin{itemize}
        \item \texttt{pre\_mean\_early}: mean log(outcome) Mar--Jun 2023
        \item \texttt{pre\_mean\_late}: mean log(outcome) Jul--Sep 2023
        \item \texttt{pre\_median\_price}: mean of monthly median transaction
            price Mar--Sep 2023
    \end{itemize}
\end{itemize}

Using pre-period means captures the outcome trend without overfitting to
month-by-month noise. Pre-period price matching helps select donors with
similar existing tax exposure.

\textbf{Outcome:} $\log(\text{transactions in \$15--\$25 range})$
per ZIP3-month.

\textbf{Implementation:} Stata \texttt{synth} package (Abadie et al.).

\section{Sample}

\begin{itemize}
    \item \textbf{Treated unit:} ZIP3 606 (Chicago)
    \item \textbf{Treatment date:} October 2023
    \item \textbf{Donor pool:} $\sim$740 ZIP3s with complete panel and
        demographic data
    \item \textbf{Panel:} Constant individual panel (cardlinkids active in
        all 70-day windows)
    \item \textbf{Transaction filter:} \$15--\$25 (ChatGPT Plus subscription
        range)
    \item \textbf{Sample period:} March 2023 -- November 2024
\end{itemize}

The \$15--\$25 filter captures ChatGPT Plus subscriptions (\$20 + tax).
Conditional on having at least one transaction in this range, the average
user has \transPerActiveMonthAll{} transactions per active month
(\transPerActiveMonthChi{} in Chicago), consistent with monthly billing.
However, from a user's first transaction to the end of the sample, only
\transPerPostFirstMonthAll{} of potential months have a transaction
(\transPerPostFirstMonthChi{} in Chicago)---not everyone renews each period.

\begin{figure}[h]
\centering
\includegraphics[width=0.9\textwidth]{\exploratorypath/chicago_vs_rest_raw.png}
\caption{Raw trends: Chicago vs.\ rest of U.S.\ log(unique users).
Vertical line marks October 2023 (PPLTT). Pre-trends differ, motivating
synthetic control over a simple DiD. \textcolor{red}{Something is wrong:
Chicago cannot exceed the entire U.S.}}}
\label{fig:pretrends_raw}
\end{figure}

\section{Results}

Table~\ref{tab:rmspe} reports the main synthetic control results.

\begin{table}[h]
\centering
\begin{tabular}{lc}
\toprule
\textbf{Metric} & \textbf{Value} \\
\midrule
Pre-treatment RMSPE (Mar--Sep 2023) & \preRMSPE \\
Post-treatment RMSPE (Oct 2023--Nov 2024) & \postRMSPE \\
RMSPE ratio (post/pre) & \rmspeRatio \\
\midrule
Average post-treatment gap & \postGapMean \\
Implied effect & $-$\effectPct\% \\
\bottomrule
\end{tabular}
\caption{Synthetic control results for Chicago (ZIP3 606).}
\label{tab:rmspe}
\end{table}

Pre-treatment RMSPE (\preRMSPE) indicates good fit. The average
post-treatment gap is \postGapMean{} ($\approx$\effectPct\% reduction);
the higher post-treatment RMSPE (\postRMSPE) reflects the widening gap
over time visible in Figure~\ref{fig:synth}.

\begin{figure}[h]
\centering
\includegraphics[width=0.9\textwidth]{\figpath/chicago_synth_stata.png}
\caption{Chicago vs.\ synthetic control. Vertical line marks October 2023
(tax implementation). Output from Stata \texttt{synth} command.}
\label{fig:synth}
\end{figure}

\section{Covariate Balance}

Table~\ref{tab:balance} shows the covariate balance between Chicago and
synthetic Chicago.

\begin{table}[h]
\centering
\begin{tabular}{lcc}
\toprule
\textbf{Variable} & \textbf{Chicago} & \textbf{Synthetic} \\
\midrule
\covBalanceRows
\bottomrule
\end{tabular}
\caption{Covariate balance for synthetic control.}
\label{tab:balance}
\end{table}

\section{Donor Weights}

Table~\ref{tab:donors} shows the ZIP3s receiving positive weight in the
synthetic control.

\begin{table}[h]
\centering
\begin{tabular}{rlr}
\toprule
\textbf{ZIP3} & \textbf{Area} & \textbf{Weight} \\
\midrule
\donorWeightsRows
\bottomrule
\end{tabular}
\caption{Top donor ZIP3s for synthetic Chicago.}
\label{tab:donors}
\end{table}

Figure~\ref{fig:spaghetti} compares Chicago to the top donors over time.

\begin{figure}[h]
\centering
\includegraphics[width=0.9\textwidth]{\figpath/chicago_spaghetti_donors.png}
\caption{Log unique users: Chicago vs.\ top donor ZIP3s.}
\label{fig:spaghetti}
\end{figure}

\section{Interpretation}

The Chicago PPLTT reduced the number of unique ChatGPT Plus subscribers
by approximately \effectPct\% relative to the synthetic counterfactual.
This is the extensive margin effect---fewer distinct cardholders making
subscription-priced transactions.

At a \$20 subscription price, a 9\% tax is \$1.80/month. A \effectPct\%
reduction in subscribers implies a demand elasticity on the order of $-1$,
though this is rough given the level shift rather than continuous price
variation.

\subsection{Identification Caveat: Manhattan Placebo}

Running the synthetic control procedure on ZIP3 100 (Manhattan) as a
placebo reveals a similar pattern: treated unit falls below its synthetic
control post-treatment. New York State has taxed SaaS at approximately
8.5\% continuously---there was no new tax in October 2023. Yet Manhattan
exhibits a similar divergence pattern, placing it toward the high end of
the placebo distribution.

\textbf{Update (Jan 2026):} A systematic scan of median transaction prices
across all ZIP3s (March 2023 vs.\ November 2024) reveals Manhattan shows a
{\color{red}+2.6\%} price increase---second only to Chicago's {\color{red}+5.7\%}% HARDCODED
(Figure~\ref{fig:taxdetect}). This price increase is consistent with
OpenAI beginning to collect New York sales tax during the sample period,
which would mean Manhattan is not a valid placebo. If so, Manhattan should
be excluded from the donor pool (not yet implemented).

Three alternative explanations for big-city divergence:

\begin{enumerate}
    \item \textbf{Big-city saturation}: Large cities may have adopted
        ChatGPT earlier and faster, saturating by late 2023.

    \item \textbf{ChatGPT Enterprise}: OpenAI launched ChatGPT Enterprise
        in August 2023. If big-city employers began paying for employee
        subscriptions, those users would stop appearing in Consumer Edge
        data (personal credit card transactions).

    \item \textbf{Synthetic construction}: No weighted combination of
        smaller areas can replicate big-city dynamics. Chicago tracks
        Manhattan because both face the same urban-specific shocks.
\end{enumerate}

\subsection{Price Pass-Through Evidence}

While quantity effects face identification challenges, price pass-through
is cleaner. Chicago's median transaction price jumps from \$\chiPrePrice{}
to \$\chiOctPrice{} exactly at October 2023, while Manhattan (existing tax)
shows no discrete jump. This confirms the tax is being passed through
to Chicago consumers.

\subsection{Placebo Check: ZIP3 077 (New Jersey Shore)}

ZIP3 077 (Long Branch / Red Bank, NJ) produces an RMSPE ratio of
{\color{red}6.90},% HARDCODED - TODO: pull from placebo results
exceeding Chicago's \rmspeRatio. However, the direction differs: 077's
post-treatment gap is \emph{positive} (+0.115), meaning actual usage
\emph{exceeded} the synthetic control. Chicago's gap is negative ($-0.118$),
meaning actual usage \emph{fell below} the synthetic control.

Figure~\ref{fig:077_price} shows flat median prices for 077 throughout the
sample---no discrete tax-induced jump. The high RMSPE ratio reflects
idiosyncratic positive shocks (perhaps local growth or demographic shifts),
not a tax effect.

This pattern does not threaten our causal interpretation: 077's divergence
is in the opposite direction from Chicago's. A true confounder would need
to produce \emph{negative} gaps in untreated areas around October 2023.

\subsection{Placebo Inference}

Figure~\ref{fig:spaghetti_placebo} shows the spaghetti plot of placebo gaps
for all ZIP3s with pre-treatment RMSPE within 2$\times$ of Chicago's. Chicago
(solid black) diverges visibly below the placebo distribution post-treatment.

\begin{figure}[h]
\centering
\includegraphics[width=0.9\textwidth]{\figpath/synthetic_placebo_robustness/placebo_spaghetti_2x.png}
\caption{Placebo gaps for ZIP3s with pre-RMSPE $\leq 2\times$ Chicago's.
Chicago is the solid black line; placebo units in gray.}
\label{fig:spaghetti_placebo}
\end{figure}

Figure~\ref{fig:histogram_placebo} shows the distribution of gap ratios
(post-treatment gap / pre-treatment RMSPE) across placebo units.

\begin{figure}[h]
\centering
\includegraphics[width=0.9\textwidth]{\figpath/synthetic_placebo_robustness/placebo_histogram_2x.png}
\caption{Distribution of gap ratios among placebo units (2$\times$ threshold).
Chicago's gap ratio marked by vertical line.}
\label{fig:histogram_placebo}
\end{figure}

\subsection{Methodological Limitations}

Compared to Abadie, Diamond, and Hainmueller's (2010) California smoking
study, our setting raises concerns about overfitting. Abadie et al.\ use
38 control states and match on 6 covariates plus 3 pre-period outcome
levels (cigarette sales in 1975, 1980, and 1988), drawing from a 19-year
pre-treatment period (1970--1988). Their covariates---ln(GDP per capita),
percent aged 15--24, retail cigarette price, and beer consumption---are
chosen with clear theoretical justification for predicting cigarette demand.

We match on 10 covariates (7 demographics plus 3 pre-period outcome
summaries) using only 7 pre-treatment months. Our donor pool contains
$\sim$740 ZIP3s, or 184 in the top-quartile restriction used for placebo
inference. With fewer pre-periods and more potential donors relative to
covariates, synthetic control has greater scope to find spurious matches.

Two specific concerns:

\begin{enumerate}
    \item \textbf{Covariate selection}: Our demographic covariates
        (college attainment, income, broadband access, STEM employment)
        were chosen based on intuitions about ChatGPT adoption, not
        prior empirical validation. Abadie et al.'s covariates have
        established relationships to cigarette consumption.

    \item \textbf{Pre-period length}: Collapsing 7 months into two
        averages (early/late) provides less information about outcome
        dynamics than matching on multiple years of pre-treatment data.
        Idiosyncratic shocks in our short pre-period may not average out.
\end{enumerate}

\section{Technical Notes}

\begin{itemize}
    \item \textbf{Constant panel:} Restricted to cardlinkids active in all
        70-day windows throughout the sample period.
    \item \textbf{Demographics source:} ACS 5-year 2022 estimates,
        aggregated from ZCTA to ZIP3 using population weights.
    \item \textbf{Pre-period price matching:} Matching on pre-period median
        price helps select donors with similar existing tax exposure.
\end{itemize}

\appendix
\section{Tax Detection Scan}

\begin{figure}[h]
\centering
\includegraphics[width=\textwidth]{/Users/jeffreyohl/Dropbox/LLM_PassThrough/output/exploratory/zip3_price_change_funnel.png}
\caption{Median transaction price change by ZIP3 (March 2023 to November
2024). Chicago (606) is the only ZIP3 exceeding the 5\% threshold.
Manhattan (100) shows {\color{red}+2.6\%}, suggesting possible tax collection starting
mid-sample. Full results in \texttt{zip3\_price\_changes.csv}.}
\label{fig:taxdetect}
\end{figure}

% Placebo Price Plots section removed - median_price_077.png not regenerated

\section{ZIP3 Reference}

For reference, key ZIP3 codes mentioned in this analysis:

\begin{table}[h]
\centering
\begin{tabular}{rl}
\toprule
\textbf{ZIP3} & \textbf{Area} \\
\midrule
606 & Chicago, IL (treated) \\
100 & Manhattan, NY \\
077 & Long Branch / Red Bank, NJ \\
069 & Garden City / Long Island, NY \\
094 & San Mateo / Silicon Valley, CA \\
174 & Binghamton, NY \\
900 & Los Angeles, CA \\
277 & Raleigh, NC \\
303 & Atlanta, GA \\
\bottomrule
\end{tabular}
\caption{ZIP3 codes referenced in this document.}
\label{tab:zip3ref}
\end{table}

\end{document}
